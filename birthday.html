<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Happy Birthday  </title>
<style>
body {
  margin: 0;
  background: black;
  text-align: center;
  font-family: monospace;
  overflow: hidden;
  color: white;
}
.rainbow {
  font-size: 48px;
  font-weight: bold;
  background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 5s linear infinite;
  position: relative;
  z-index: 2;
}
@keyframes rainbow { 0% {background-position:0%} 100% {background-position:100%} }

.cake {
  font-size:16px;
  color:magenta;
  white-space: pre;
  position: relative;
  z-index:2;
}
.flame {
  color: orange;
  font-size:20px;
  animation: flicker 0.5s infinite alternate;
  position: relative;
  z-index:2;
}
@keyframes flicker { from{color:orange} to{color:red} }

#lyrics { margin-top:20px; font-size:24px; color:lime; min-height:40px; position: relative; z-index:2; }
#greeting { margin-top:30px; font-size:28px; color:cyan; font-weight:bold; position: relative; z-index:2; }

canvas { position: fixed; top:0; left:0; z-index:1; }

.dance {
  position: absolute;
  bottom: 50px;
  font-size: 60px;
  animation: danceAnim 1s infinite alternate;
}
@keyframes danceAnim {
  0% { transform: translateY(0) rotate(-10deg); }
  50% { transform: translateY(-20px) rotate(10deg); }
  100% { transform: translateY(0) rotate(-10deg); }
}
#bear { left: 20%; }
#rabbit { right: 20%; }
</style>
</head>
<body>

<canvas id="fireworks"></canvas>

<h1 class="rainbow">Happy Birthday!</h1>
<div class="flame"> (  )  (  )  (  )  (  ) </div>
<div class="cake">
    ,   ,   ,   ,<br>
   ||  ||  ||  ||<br>
 =================<br>
 |              |<br>
 |    HAPPY     |<br>
 |   BIRTHDAY   |<br>
 |______________|
</div>

<div id="lyrics"></div>
<div id="greeting"></div>

<div id="bear" class="dance">üêª</div>
<div id="rabbit" class="dance">üê∞</div>

<script>
// --- Web Audio API ---
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const notes = {
  C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23,
  G4: 392.00, A4: 440.00, Bb4: 466.16, B4: 493.88,
  C5: 523.25
};
const melody = [
  ["C4",400], ["C4",400], ["D4",800], ["C4",800], ["F4",800], ["E4",1600],
  ["C4",400], ["C4",400], ["D4",800], ["C4",800], ["G4",800], ["F4",1600],
  ["C4",400], ["C4",400], ["C5",800], ["A4",800], ["F4",800], ["E4",800], ["D4",800],
  ["Bb4",400], ["Bb4",400], ["A4",800], ["F4",800], ["G4",800], ["F4",1600]
];
const lyrics = [
  "Happy birthday to you üéµ",
  "Happy birthday to you üé∂",
  "Happy birthday to youüéÇüéÇüéÇ",
  "Happy birthday to you üéâ"
];
const greetingMsg = "üéä   ÁîüÊó•Âø´Ê®ÇÔºÅÁ•ù‰Ω†Ê∞∏ÈÅ†Âπ∏Á¶è„ÄÅÂÅ•Â∫∑„ÄÅÂøÉÊÉ≥‰∫ãÊàê üéä";

function playTone(freq,dur){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.type = "sine";
  osc.frequency.value=freq;
  gain.gain.setValueAtTime(0.25, ctx.currentTime);
  osc.start();
  osc.stop(ctx.currentTime+dur/1000);
  return new Promise(res=>setTimeout(res,dur));
}

async function playSong(){
  const lyricsDiv = document.getElementById("lyrics");
  const greetingDiv = document.getElementById("greeting");
  let lyricIndex=0;
  for(let i=0;i<melody.length;i++){
    const [note,dur]=melody[i];
    if([5,11,18,25].includes(i)){
      lyricsDiv.textContent="";
      await typeWriter(lyrics[lyricIndex++],lyricsDiv);
    }
    await playTone(notes[note]||440,dur);
  }
  greetingDiv.textContent="";
  await typeWriter(greetingMsg,greetingDiv,80);
}

function typeWriter(text,el,delay=120){
  return new Promise(resolve=>{
    let i=0;
    const timer=setInterval(()=>{
      el.textContent+=text[i];
      i++;
      if(i===text.length){clearInterval(timer);resolve();}
    },delay);
  });
}

// --- ÈªûÊìäÊí≠Êîæ ---
document.body.addEventListener("click",()=>playSong(),{once:true});

// --- Á∞°ÂñÆÁÖôÁÅ´ ---
const canvas = document.getElementById('fireworks');
const ctx2 = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;
const fireworks=[];
function random(min,max){return Math.random()*(max-min)+min;}
function createFirework(){
  const x=random(50,canvas.width-50);
  const y=random(50,canvas.height/2);
  const colors=["red","orange","yellow","lime","cyan","magenta","white"];
  const particles=[];
  for(let i=0;i<50;i++){
    const angle=Math.random()*2*Math.PI;
    const speed=Math.random()*5+2;
    particles.push({x,y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,color: colors[Math.floor(Math.random()*colors.length)],alpha:1});
  }
  fireworks.push(...particles);
}
function animate(){
  ctx2.fillStyle="rgba(0,0,0,0.2)"; ctx2.fillRect(0,0,canvas.width,canvas.height);
  for(let i=fireworks.length-1;i>=0;i--){
    const p=fireworks[i];
    ctx2.fillStyle=p.color; ctx2.globalAlpha=p.alpha;
    ctx2.beginPath(); ctx2.arc(p.x,p.y,2,0,Math.PI*2); ctx2.fill();
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.alpha-=0.02;
    if(p.alpha<=0) fireworks.splice(i,1);
  }
  ctx2.globalAlpha=1;
  requestAnimationFrame(animate);
}
setInterval(createFirework,500);
animate();
</script>
</body>
</html>
